<%= provide :title, t(".title") %>
<%= javascript_include_tag "store_bookings/show.js" %>
<div class="content-header">
  <div class="header-section">
    <h1>
      <i class="gi gi-usd"></i><%= t ".your_bookings" %>
    </h1>
  </div>
</div>
<% @venues.each_with_index do |venue, parent_index| %>
  <%= render "header", venue: venue %>
  <div class="block full">
    <div class="block-title">
      <div class="block-options pull-right">
        <a href="javascript:" class="btn btn-sm btn-alt btn-default"
          data-toggle="tooltip" title="<%= t ".title_toogle" %>">
          <i class="fa fa-times"></i>
        </a>
      </div>
      <h2><strong><%= venue.name %></strong></h2>
    </div>
    <div class="row block-section">
      <div class="col-sm-12">
        <h4> <%= venue.address.details %></h4>
        <address>
          <i class="fa fa-phone"></i> <%= venue.phone_number %><br>
          <i class="fa fa-envelope-o"></i>
          <a href="javascript:"><%= venue.email %></a>
        </address>
      </div>
      <div class="request-all">
        <%= button_tag t(".accept_all"), class: "btn btn-danger check-all",
          id: "#{venue.id}" %>
      </div>
    </div>
    <div class="table-responsive">
      <table class="table table-vcenter bookings-table">
        <tbody>
          <% if venue.orders.length != 0 %>
            <% venue.orders.each_with_index do |order, index| %>
              <% order.bookings.each do |booking| %>
                <tr>
                  <td>
                    <h4><%= link_to booking.space.name %></h4>
                    <span class="label label-danger">
                      <%= booking.user.name %>
                    </span>
                    <span class="label label-warning">
                      <%= l booking.booking_from, format: :default %>
                    </span>
                    <span class="label label-primary">
                      <i class="fa fa-clock-o"></i>
                      <%= booking.duration %>
                      <%= booking.booking_type.name %>
                    </span>
                  </td>
                  <td class="text-center">
                    <%= image_tag "spaces/space1.jpg", class: "image_tag" %>
                  </td>
                  <td class="text-center">
                    <strong>x
                      <span class="badge" id="quantity-<%= booking.id %>">
                        <%= booking.quantity %>
                      </span>
                    </strong></td>
                  <td class="text-right">
                    <span class="label label-success" id="price-<%= booking.id %>">$
                      <%= select_price(booking.space, booking.booking_type_id) %>
                    </span>
                  </td>
                  <td class="text-center">
                    <%= form_tag booking_path(booking), method: :patch do |f| %>
                      <fieldset>
                        <%= hidden_field_tag "checked_button", check_reject_or_accept(booking),
                          id: "checked_button-#{parent_index}-#{index}" %>
                        <%= hidden_field_tag "total_index", @venues.length,
                          id: "total_index" %>
                        <%= hidden_field_tag "times", venue.orders.length,
                          id: "times-#{parent_index}" %>
                        <%= hidden_field_tag "booking_ids", booking.id,
                          class: "booking_ids-#{venue.id}" %>
                        <div class="switch-toggle well" id= "confirm-button">
                          <input id="rejected-<%= booking.id %>" value="<%= Booking.states.keys[3] %>" name="<%= booking.id %>" type="radio" class="state">
                          <label for="rejected-<%= booking.id %>" id="rejected-label">
                            <%= Booking.states.keys[3] %>
                          </label>
                          <input id="requested-<%= booking.id %>" name="<%= booking.id %>" type="radio" class="state"   value="<%= Booking.states.keys[1] %>" disabled>
                          <label for="requested-<%= booking.id %>" id="requested-label">
                            <%= Booking.states.keys[1] %>
                          </label>
                          <input id="accepted-<%= booking.id %>" name="<%= booking.id %>" type="radio" class="state"
                            value="<%= Booking.states.keys[2] %>">
                          <label for="accepted-<%= booking.id %>" id="accepted-label">
                            <%= Booking.states.keys[2] %>
                          </label>
                          <a class="btn btn-primary"></a>
                        </div>
                      </fieldset>
                    <% end %>
                  </td>
                </tr>
              <% end %>
            <% end %>
          <% end %>
          <tr class="active">
            <td colspan="4" class="text-right">
              <span class="h3 total_due">
                <strong><%= t ".total_due" %></strong>
              </span>
            </td>
            <td class="text-right">
              <span class="h3">
                <strong id="total-price-<%= venue.id %>"></strong>
              </span>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
<% end %>
